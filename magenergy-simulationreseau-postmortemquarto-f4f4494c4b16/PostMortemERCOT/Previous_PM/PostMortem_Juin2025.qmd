<!-- quarto preview PostMortem.qmd pour la preview du document -->
<!-- quarto render PostMortem.qmd  pour cr√©er le html-->
<!-- Dans les commentaires, enlever les $ -->
---
title: "Postmortem ERCOT Juin 2025"
author: "Florian ETIENNE"
date: today
toc: true
jupyter: postmortem
format:
  html:
    embed-resources: true
    code-tools: true
    grid:
    #   margin-width: 0px  # Reduces side margins
      body-width: 1400px  # Adjusts main content width (default is ~800px)
execute:
  cache: false
  echo: true  # Keep code visible by default
  code-tools: true  # Add show/hide button for each code block

---

## üõ†Ô∏è Points √† discuter et Projets
- MAJ de mod√®le automatique √† partir du rawfile le plus r√©cent (En cours)
    - Mettre √† jour le mod√®le de dayzer avec le CRR le plus r√©cent, ajustement des
    requ√™te par rapport √† des bugs.
- Projet de validation (En cours)
    - Jared a presque fini de son bord, la prochaine √©tape serait de faire un confluence pour expliquer comment cr√©er des requ√™tes de validations.
- NerdMonkey (Outil d'analyse de contrainte) (En pause)
- Refonte des scripts d‚Äôajout de contraintes automatiques pour ERCOT (A faire)
- Faire une √©tude de contingence (A faire)
- NerdDogPerCluster (ML pour sortir les contraintes fortes) (Pause)


<!-- Importation des librairies et initalisation de la connection -->
```{python}
#| code-fold: true
# Import necessary libraries
from services import snowflake_queries as sq
from components import graph_utils as gu, constraint_utils as cu
import plotly.graph_objects as go
from services.database_connection import init_connection
from itables import show, JavascriptFunction
import ipywidgets as widgets

conn=init_connection()
```

## üìà Evolution de la load et du vents


```{python}
#| code-fold: true
#| eval: true
df_Load=sq.get_Load(['ERCOT_1DA_Default'
                  ,'ERCOT_1MA_Default'
                  ,'ERCOT_1DA_Default'
                  ,'ERCOT_1MA_LoadMax'
                  ,'ERCOT_1MA_LoadNormal_SAI'
                  ,'ERCOT_1MA_LoadMax_SAI'
                  ,'ERCOT_1MA_LoadMin_SAI']
                  ,'2020-01-01'
                  ,'2025-06-30'
                  ,conn
                  )
df_Wind=sq.get_Wind(['ERCOT_1DA_Default'
                  ,'ERCOT_1MA_Default'
                  ,'ERCOT_1DA_Default'
                  ,'ERCOT_1MA_WindMaxExt'
                  ,'ERCOT_1MA_WindMinExt']
                  ,'2020-01-01'
                  ,'2025-06-30'
                  ,conn
                  )

gu.create_graph_load(df_Load,'TOTAL','2025-06-01','2025-06-30')
gu.create_graph_wind(df_Wind,'2025-06-01','2025-06-30')
```

## ùÑú Top contraintes du mois

```{python}
#| code-fold: true
#| eval: true
#| cache: false
df_PM=sq.get_PostMortem(5
                        ,'2025-06-01'
                        ,'2025-06-30'
                        ,['ERCOT_1MA_Default','ERCOT_1MA_AvgSP','ERCOT_1MA_AvgSP_1month','ERCOT_1MA_NerdDog']
                        ,conn)

df_PM.fillna(0,inplace=True)
exclude_columns = ["CID_MAG", "CID_CES", "CONSTRAINTNAME","CONTINGENCYNAME"]

# Apply formatting to all other columns
for col in df_PM.columns:
    if col not in exclude_columns:
        df_PM[col] = df_PM[col].apply(lambda x: f"${x:,}")

# Apply formatting to all other numeric columns


show(df_PM,
    classes="compact",
    column_filters="header", 
    layout={"topEnd": None}, 
    style="font-size: 12px;",
    )
```


## üïµÔ∏è Analyses des contraintes
```{python}
#| code-fold: true
#| cache: true
# param√®tres g√©n√©raux
pool_id=5
ftrstartdate='2025-06-01'
ftrenddate='2025-06-30'
histostartdate='2025-03-01'
histoenddate='2025-06-30'
scenario_flows=['ERCOT_1MA_Default','ERCOT_1DA_Default','ERCOT_1MA_DA_LIM','ERCOT_1MA_Outages']
scenario_first_priority='ERCOT_1DA_Default'
scenario_sf=['ERCOT_1MA_Default','ERCOT_1DA_Default','ERCOT_1MA_Outages']
scenario_histo_sp=['ERCOT_1MA_Default',
                    'ERCOT_1DA_Default',
                    'ERCOT_1MA_DA_LIM',
                    'ERCOT_1MA_LoadMax',
                    'ERCOT_1MA_NerdDog',
                    'ERCOT_1MA_NerdDogPerCluster_V1'
                    ]
```

<details>
  <summary>362548 6437__F:DMTSCOS5</summary>

**Analyse prebid Fran√ßois:**

La contrainte a √©t√© forte √©t√© 2023 en raison de transmission outage.
Elle a aussi √©t√© forte au printemps 2025 en raison de transmission outage. 

Des transmission outage sont pr√©vue (2) aussi pour Juin, mais leur effet semble s'annuler et ne semble pas tant que ca faire bind√© la contrainte. 
En raison de son historique en √©t√©2023 et printemps 2025, les ShadowCost sont √©l√©v√©. 
En Mai2025, les shadowcost sont vraiment plus √©l√©v√© que les ShadowPrice yet, malgr√© la pr√©sence des transmission outage qui ont fait bind√© la ctr en Avril (et qui se termine a la mi mai).
Bref, j'ai comme l'impression que la contrainte pourrait bind√©, mais que les shadowprice pourrait √™tre plus faible que les shadowCost, d'ou un potentiel short.
Mais ca pourrait √™tre risqu√©, c'est pouruqoi je met le potentiel a 2. 

Perso, je ne suis pas assez confiant pour sugg√©r√© ce path sans qu'un deuxi√®me avis me secondes ou me r√©fute.

FE: Le short me semble tr√®s risqu√©, si vous voulez aller de l'avant avec il faudrait le faire avec des prix tr√®s conservateurs

HB ou EA: Path short√©, en OFF et WDON.


**Analyse postbid:**

Cumule de plusieurs outages qui l'a fait bind. Elle est d√©pendante de la load et de la load industriel.
 
```{python}
#| echo: false
#| eval: true
cu.get_all_cstr_data(pool_id,
                      50006479,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )

```
</details>


<details>
  <summary>377398	POT_PEAR_1:SPLSFAS9</summary>

**Analyse postbid:**

Contrainte impact√© par le solaire, notamment l'unit√© Morrow Lake Solar
install√© en septembre 2024, qui rajoute 6MW sur la contrainte.

le projet de mise √† jour des mod√®les pourrait am√©liorer
les flows de dayzer.
Egalement un sc√©nario SolMax pourrait nous permettre de capter ce genre de contrainte
```{python}
#| echo: false
#| eval: true
cu.get_all_cstr_data(pool_id,
                      50017450,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )

```
</details>


<details>
  <summary>378350	ABNTHW_SERDEV1_1:SABIABM8</summary>

**Analyse postbid:**
Contrainte mieux capter avec le mod√®le 239, Ajout√© dans le mod√®le le 18 Mai
apr√®s les bids. On n'avait donc pas la contriante dans nos simulations de Juin.
La contrainte a eu un abaissement de limite le 22 mai ce qui semble √™tre un des facteurs de bind de la contrainte.
En exploitant les donn√©es du fichiers "rating report" on aurait pu voir l'abaissement de limite sur cette ligne.
Cet abaissement est sans doute l√† pour prot√©ger la ligne durant l'√©t√©.


Egalement pour la capter, ils nous auraient fallu mettre √† jour le mod√®le avec les donn√©es les plus r√©centes
et faire une √©tude de contingence.
```{python}
#| echo: false
#| eval: true
cu.get_all_cstr_data(pool_id,
                      50028247,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )

```
</details>

<details>
  <summary>370549	HAINE__LA_PAL1_1:MHARNED5</summary>

**Analyse prebid Florian:**


"Congestion forte dans le sud d'ERCOT, Bind actuellement √† cause de l'outage burns riohondo qui devrait finir le 15mai., beaucoup de travaux dans la zone  Lower Rio Grande Valley  (LRGV) pour r√©duire la congestion, Lorsque Burns Rio hondo aura termin√©, sa ligne devrait √™tre augment√©. HAINE_LA PALMA devrait √™tre moins √† risque de bind sans l'outage HAINE_LA_PALMA. 

ChatGPT DeepSearch:The HAINE__LA_PAL1_1:MHARNED5 constraint represents a critical congestion point in ERCOT‚Äôs Lower Rio Grande Valley, reflecting the challenges of integrating rapid renewable generation growth in a transmission-constrained area. It is centered on the Haine Drive ‚Äì La Palma 138‚ÄØkV line in Brownsville‚Äôs vicinity, which often must shoulder large flows when key 345‚ÄØkV/138‚ÄØkV elements are out of service. This constraint is typically activated to protect system reliability under a severe (N-2) contingency, and has historically incurred notable congestion costs by limiting generation in the valley.

Le bind de la contrainte devrait √™tre moins √©lev√©. A shorter avec des prx conservateurs."

HB: Je ne suis pas tr√®s √† l'aise de shorter cette contrainte encore, surtout l'√©t√©.

**Analyse postbid:**

L'outage √©tait pr√©vu jusqu'au 19 juin avant bid. Depuis qu'ill a termin√© les flows sur la contrainte sont loin de la limite
et la contrainte ne bind plus en RT.

```{python}
#| echo: false
#| eval: true
cu.get_all_cstr_data(pool_id,
                      50011660,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )

```
</details>

<details>
  <summary>370091	1710__C:DSALHUT5</summary>

**Analyse prebid Florian:**

Contrainte forte l'√©t√©, 2023 et 2024, contrainte de load. Devrait √™tre forte pour Juin 2025 √©galement, elle risque d'√™tre pric√© mais se positionner long tout de m√™me.


HB: On est d√©j√† long dessus. J'ai enlev√© tous les shorts qui avaient RHESS2 en Source
Path ajout√© en plusieurs tranches.

**Analyse postbid:**

Contrainte d√©pendante de la load, forte l'√©t√©. A partir du 23 Mai, il y a une forte r√©duction des flows d√ª √† un outage.
Ce qui ne semble pas √™tre le cas en vrai. Voir si avec le projet de MAJ automatique, on am√©liorerait ces r√©sultats. 
Avec le package 239 cette forte r√©duction disparait.
```{python}
#| echo: false
#| eval: true
cu.get_all_cstr_data(pool_id,
                      50011309,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )

```
</details>

<details>
  <summary>377018	OLS_JNES_1:XHA2S89</summary>

**Analyse postbid:**
Contrainte d√©pendante de la load et de l'outage 
OLS_SYCA1 pr√©vu du 2 juin au 15 juillet. L'outage √©tait pr√©vu avant bid,
mais les flows √©taient l√©g√®rement en dessous de la limite ce qui ne l'a pas fait bind
en Default, on avait tout de m√™me un signal en Load Max.


Peut √™tre qu'avec une MAJ du mod√®le on aurait eu un signal en 1MA_Default.
Analyser les contraintes qui n'ont jamais bind√© et dont les flows sont tr√®s proche de la limite d√ª √† un outage.
```{python}
#| echo: false
#| eval: true
cu.get_all_cstr_data(pool_id,
                      50017102,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )

```
</details>

<details>
  <summary>25102117	ORNT_REDCRE1_1:MXMU158</summary>

**Analyse prebid ORNT_REDCRE1_1:SGARBAL8:**

Contrainte impact√© par R-EL_MULBERRY pr√©vu du 28 avril au 27 novembre et par R-WH_MULBERRY pr√©vu du 30 avril au 13 juin.
LA contrainte pourrait donc continuer de binder et affecter les m√™mes paths que la contrainte concho_vrbs. Se positionner long

**Analyse postbid:**

Contrainte ajout√© apr√®s bid. 
Script d'ajout des contraintes √† am√©liorer,
La contrainte bind depuis que la contingence est monitor√©. (1er Mai)
Il n'y a pas un facteur unique qui cause son bind. Mais plusieurs facteurs
qui cause un d√©passement de limite.
```{python}
#| echo: false
#| eval: true
cu.get_all_cstr_data(pool_id,
                      50028726,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )

```
</details>

<details>
  <summary>373772 CONCHO_VRBS1_1:DBRNCMN8</summary>

**Analyse prebid Florian:**

Contrainte dont l'outage de CB 6230 MILES r√©duit drastiquement les flows sur la ligne. lorsqu'il a lieu, les dates de cet outage changent tr√®s rapidement. d'o√π le fait qu'on va voir des flows sur la ligne dans panorama puis d'un coup pas de flows. A priori l'outage devrait s'arr√™ter le 20 Mai ce qui ferait que la contrainte binderait en Juin. Ce positionner lond dessus.

Path bid√©. Le SF est tr√®s faible et il est assez difficile de s'exposer sur cette contrainte


**Analyse postbid:**

Analyse en Prebid bonne, il y a eu quelques journ√©es en Juin o√π la contrainte a bind√© fortement. 
```{python}
#| echo: false
#| eval: true
cu.get_all_cstr_data(pool_id,
                      50014192,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )

```
</details>

<details>
  <summary>4500014 6056__Z:DBAKCED5</summary>

**Analyse postbid:**

Circuit parall√®le √† 6056__A. 6056__A est en outage depuis le 14 Mai et ce jusqu'au 22 septembre. Le circuit 6056__Z l'a donc remplac√©.
6056__Z  va donc binder √† la place de 6056__A. Dans dayzer il est pr√©f√®rable de regarder les flows sur 6056__A, la ligne 6056__Z √©tant en OOS. 
```{python}
#| echo: false
#| eval: true
cu.get_all_cstr_data(pool_id,
                      50028584,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )

```
</details>

<details>
  <summary>25102116 SEA_AAT1:MDFRYSK8</summary>

**Analyse prebid SEA_AAT1:DSALTM58:**

FETIENNE:
Contrainte qui avait bind fortement en Mai et Juin 2024 √† cause d'outages et de la load. En juin plusieurs outages sont pr√©vu qui pourrait impacter la contrainte. 35050_B du 11 au 30 juin. et OLS_SYCA du 2 juin au 15 juillet. Elle pourrait binder fortement avec la load plus √©lev√© en √©t√©. Soyez long sur cette contrainte!

**Analyse postbid:**

Plusieurs outages qui impactent la contrainte. La contingence a commencn√© √† √™tre monitor√© √† partir du 25 Mai, il aurait √©t√© difficile d'avoir 
la contrainte exact avant bid.
```{python}
#| echo: false
#| eval: true
cu.get_all_cstr_data(pool_id,
                      50028676,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )

```
</details>

<details>
  <summary>4500244	VND_PLCE_1:DRICLOU8</summary>

**Analyse postbid:**
Contrainte ajout√© apr√®s bid, Bind √† cause des outages RAY_VANB1 et FOR_INEZ1 pr√©vu du 23 au 30 juin.
Les outages fuent visible qu'√† partir du 21 Mai.
```{python}
#| echo: false
#| eval: true
cu.get_all_cstr_data(pool_id,
                      50028711,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )

```
</details>

<details>
  <summary>300057	LENSW_PUTN2_1:BASE CASE</summary>

**Analyse postbid:**
Contrainte qui √©tait en outage du fait d'un upgrade sur la ligne principale et qui a termin√©
le 22 mai. Les flows en mensuels √©taient mal mod√©lis√©s. 

A voir si avec notre maj de mod√®le on aurait pu la capter.
```{python}
#| echo: false
#| eval: true
cu.get_all_cstr_data(pool_id,
                      50026409,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )

```
</details>

