---
title: "Postmortem ERCOT Fevrier 2025"
author: "Florian ETIENNE"
date: today
toc: true
jupyter: postmortem
format:
  html:
    embed-resources: true
    code-tools: true
    grid:
    #   margin-width: 0px  # Reduces side margins
      body-width: 1400px  # Adjusts main content width (default is ~800px)
execute:
  echo: true  # Keep code visible by default
  code-tools: true  # Add show/hide button for each code block

---

## üõ†Ô∏è Points √† discuter et Projets

- Refonte de la pr√©sentation PostMortem (Fait)
- NerdMonkey (En cours)
    - Am√©liration de l'affiche de certains tableau 
    - Ajout de description plus √©toff√©e sur les contraintes.
- MAJ de mod√®le automatique √† partir du rawfile le plus r√©cent (En cours)
    - Mettre √† jour le mod√®le de dayzer avec le CRR le plus r√©cent, puis mettre √† jour avec le DA le plus r√©cent.
- Refonte des scripts d‚Äôajout de contraintes automatiques pour ERCOT (A faire)
- Faire une √©tude de contingence (A faire)
- NerdDogPerCluster (A faire)


<!-- Importation des librairies et initalisation de la connection -->
```{python}
#| code-fold: true
# Import necessary libraries
from services import snowflake_queries as sq
from components import graph_utils as gu, constraint_utils as cu
import plotly.graph_objects as go
from services.database_connection import init_connection
from itables import show, JavascriptFunction
import ipywidgets as widgets

conn=init_connection()
```

## üìà Evolution de la load et du vents


```{python}
#| code-fold: true

df_Load=sq.get_Load(['ERCOT_1DA_Default'
                  ,'ERCOT_1MA_Default'
                  ,'ERCOT_1DA_Default'
                  ,'ERCOT_1MA_LoadMax'
                  ,'ERCOT_1MA_LoadNormal_SAI'
                  ,'ERCOT_1MA_LoadMax_SAI'
                  ,'ERCOT_1MA_LoadMin_SAI']
                  ,'2020-01-01'
                  ,'2025-03-31'
                  ,conn
                  )
df_Wind=sq.get_Wind(['ERCOT_1DA_Default'
                  ,'ERCOT_1MA_Default'
                  ,'ERCOT_1DA_Default'
                  ,'ERCOT_1MA_WindMaxExt'
                  ,'ERCOT_1MA_WindMinExt']
                  ,'2020-01-01'
                  ,'2025-03-31'
                  ,conn
                  )

gu.create_graph_load(df_Load,'TOTAL','2025-03-01','2025-03-31')
gu.create_graph_wind(df_Wind,'2025-03-01','2025-03-31')
```

## ùÑú Top contraintes du mois

```{python}
#| code-fold: true

df_PM=sq.get_PostMortem(5
                        ,'2025-03-01'
                        ,'2025-03-31'
                        ,['ERCOT_1MA_Default','ERCOT_1MA_AvgSP','ERCOT_1MA_AvgSP_1month','ERCOT_1MA_NerdDog']
                        ,conn)

df_PM.fillna(0,inplace=True)
exclude_columns = ["CID_MAG", "CID_CES", "CONSTRAINTNAME","CONTINGENCYNAME"]

# Apply formatting to all other columns
for col in df_PM.columns:
    if col not in exclude_columns:
        df_PM[col] = df_PM[col].apply(lambda x: f"${x:,}")

# Apply formatting to all other numeric columns


show(df_PM,
    classes="compact",
    column_filters="header", 
    layout={"topEnd": None}, 
    style="font-size: 12px;",
    )
```


## üïµÔ∏è Analyses des contraintes
```{python}
#| code-fold: true

# param√®tres g√©n√©raux
pool_id=5
ftrstartdate='2025-03-01'
ftrenddate='2025-03-31'
histostartdate='2025-03-01'
histoenddate='2025-03-31'
scenario_flows=['ERCOT_1MA_Default','ERCOT_1DA_Default','ERCOT_1MA_DA_LIM','ERCOT_1MA_Outages']
scenario_first_priority='ERCOT_1DA_Default'
scenario_sf=['ERCOT_1MA_Default','ERCOT_1DA_Default']
scenario_histo_sp=['ERCOT_1MA_Default',
                    'ERCOT_1DA_Default',
                    'ERCOT_1MA_DA_LIM',
                    'ERCOT_1MA_LoadMax',
                    'ERCOT_1MA_NerdDog',
                    'ERCOT_1MA_NerdDogPerCluster_V1'
                    ]
```
<details>
  <summary>367097	HARGRO_TWINBU1_1:DBAKCED5</summary>

- Contrainte impact√©e par la load et la load industriel. 
- Contrainte avec la m√™me ligne principale qui avait bind fortement l‚Äôhiver dernier. 
- Plut√¥t bien modelis√©e dans Dayzer.

**Analyse prebid trader:**

*Contrainte tr√®s sensible √† la charge industrielle √† l'Ouest de San Antonio. Le vent et le solaire r√©duisent les flows sur la ligne, alors il est pr√©f√©rable de la viser durant la nuit (OffPeak). Une combinaison d'outages l'impacte actuellement, dont le 6045_A. √Ä partir du 30 Janvier, c'est le 6046_A qui prendra le relai et est suppos√© durer jusqu'au 30 Janvier 2026. Panorama indique que l'outage GIRVIN_NEVIL1_LN aura un impact significatif aussi. La limite du mod√®le CRR est la m√™me que dans Panorama alors que le sc√©nario DA_LIM semble consid√©rer une limite √† 143MW. Cela ne change pas la conclusion. Aucun shadowCost sur la contrainte pour le moment alors qu'elle est √† son deuxi√®me mois de suite de bind, je m'attends √† ce que le shadow cost soit fort pour le mois de F√©vrier, elle est donc √† cibler de mani√®re prudente.¬†¬ª
Position:Long, peakid=4*

```{python}
#| echo: false

cu.get_all_cstr_data(pool_id,
                      50009231,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )

```

</details> 

<details>
  <summary>368817	BIGLAK_PHBL_T1_1:SOZNFRI9</summary>

- Contrainte d√©pendante des PAR, Le schedule est g√©r√© par le transmission operator. Difficile de savoir si elle est √† risque √† l‚Äôavance. CES a la m√™me conclusion

```{python}
#| echo: false
cu.get_all_cstr_data(pool_id,
                      50010463,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )
```

</details> 

<details>
  <summary>376896 LAKENA_SAMATH1_1:DBAKCED5</summary>

- Lors de la mise en place du nouveau mod√®le en d√©cembre, Dayzer n‚Äôavait pas update le mod√®le avec les derniers changements topologiques. J‚Äôai appliqu√© les changements durant la p√©riode de bid, fait que seul la simulation ERCOT_1MA_Outages avait la contrainte de mod√©lis√©.


**Analyse prebid Analyste:**

*Contrainte qui bind fortement r√©cemment. Impact√© par les load industriels. Le solaire fait baisser les flows sur la contrainte. Plus √† risque de bind en OffPeak. A priori pas de projets d'augmentations de lignes, elle devrait donc continuer de binder. La contrainte est d√©j√† bien pric√©. Je conseillerai de rester neutre dessus.*

```{python}
#| echo: false
cu.get_all_cstr_data(pool_id,
                      50026049,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )
```

</details> 

<details>
  <summary>376189 1680__A:DBERNAR8</summary>

- Premier bind de la contrainte. Capt√© dans aucun de nos sc√©narios. Outage 221T355_1 et 353T353_1 qui rajoute de la pression sur la contrainte. Bien qu‚Äôen daily on voit les flows se rapprocher de la limite, elle reste quand m√™me mal mod√©lis√©e. L‚Äôimpact de ces outages est peu visible sur la contrainte. Voir avec CES pourquoi.


```{python}
#| echo: false

cu.get_all_cstr_data(pool_id,
                      50016307,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )
```

</details> 

<details>
  <summary>25102123 6520__E:MMOSME35</summary>

- Contrainte dont la ligne principale bind beaucoup depuis Aout 2024. Nouvelle contingence qui semble √™tre monitor√©e par le march√© √† partir du 30 d√©cembre. Contrainte d√©pendante de la load industrielle. Dans Panorama la contrainte semble binder √† cause de l‚Äôoutage 36430_A additionn√© √† d‚Äôautres outages.


**Analyse prebid Analyste:**

*Contrainte dont la ligne principale a beaucoup bind√© depuis Aout. Cette contrainte bind depuis fin d√©cembre. Elle est √† risque en off peak du fait que le solaire r√©duise les flows sur la contrainte. Elle est affect√©e par l'outage 34630_A pr√©vu du 27 d√©embre au 1er d√©cembre 2025. Pas de projet d'augmentation de la ligne en cours, elle devrait donc continuer de binder. Le shadowcost est d√©j√† pric√© donc ne pas √™tre trop agressif*


```{python}
#| echo: false
cu.get_all_cstr_data(pool_id,
                      50018618,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )
```

</details> 

<details>
  <summary>378294 ABNTHW_SERDEV1_1:XABM58</summary>

- Limite de la ligne qui √©tait de 345MW avant de rouler les simulations, puis qui est pass√© √† 173MW √† partir du 30 janvier. Avec cette nouvelle limite la contrainte a bind√© fortement en 2 jours durant la vague de froid. La limite semble avoir √©t√© r√©ajust√© √† 202 MW. Pour √©viter ce fort bind de la contrainte.

![Alt text](images/abnth.png)

- Demander √† CES si ils ont une id√©e de pourquoi certaines limites sont ajust√©es √†  la baisse dans ERCOT.

- Contrainte ajout√© apr√®s bid par nos scripts automatiques.
</details> 

<details>
  <summary>372157 STCO_STER1_1:DBAKCED5</summary>

- Capt√© par quelques sc√©narios en monthly, d√©pendante du vent. 


```{python}
#| echo: false

cu.get_all_cstr_data(pool_id,
                      50012888,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )
```

</details> 

<details>
  <summary>370549 HAINE__LA_PAL1_1:MHARNED5</summary>

- D√©pendante du vent. 

**Analyse prebid Analyste KA:**

*M√™me liste des outages que la contrainte #22.
Contrainte de vent avec une limite de une limite de 200 MW.
Les outages 1) et 2) mettent une bonne pression (jusqu'√† 65 MW), l'outage 3) soulage d'environ 15 MW, et le 4e outage soulage un tout petit peu (<5 MW). Donc globalement on a une bonne pression et la contrainte devrait continuer √† binder*

```{python}
#| echo: false

cu.get_all_cstr_data(pool_id,
                      50011660,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )
```

</details> 

<details>
  <summary>378325 6345__I:MWLFME25</summary>


- A bind fortement durant la vague de froid. Contrainte pr√©sente lors de la mise en place d'un nouveau mod√®le, donc apr√®s bid


```{python}
#| echo: false

cu.get_all_cstr_data(pool_id,
                      50027648,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )
```

</details> 

<details>
  <summary>372792 STEWAR_VERTRE1_1:SMVRLA_8</summary>


- Capt√© par LoadMax. 
- Contrainte d√©pendante de la load south et des unit√©s Vancourt Solar et Rayos Del Solar. 
- Contrainte qui bind √©norm√©ment en RT quand la load South est √©lev√©e en hiver, c‚Äô√©tait le cas les 3 derni√®res ann√©es. A surveiller pour 2026. 


```{python}
#| echo: false

cu.get_all_cstr_data(pool_id,
                      50013410,
                      ftrstartdate,
                      ftrenddate,
                      histostartdate,
                      histoenddate,
                      scenario_flows,
                      scenario_first_priority,
                      scenario_sf,
                      scenario_histo_sp,
                      conn
                      )
```

</details> 